<%= 'working' %>

Provenance report for these accounts:

<% query([nil,RDF.type,OPM.Account]).each_subject do |s| -%>
  <%= s %>
<%end-%>

<% query([nil,RDF.type,OPM.Process]).
  each_subject do |p| %>
  The process  <%= p %> had the following outputs:
  <% query([nil,OPM.cause,p]).each_subject do |output| -%>
  <% next unless first([output,RDF.type,OPM.WasGeneratedBy]) -%>
  <%= first_object([output,OPM.effect,nil]) %> <% role=first_object([output,OPM.role,nil])%> <%if role!=AMEE.output%>with role <%= role%><%end%>
  <% end -%>
  ... and the following inputs:
   <% query([nil,OPM.effect,p]).each_subject do |input| -%>
  <% next unless first([input,RDF.type,OPM.Used]) -%>
  <%= first_object([input,OPM.cause,nil]) %><% role=first_object([input,OPM.role,nil])%> <%if role!=AMEE.input%>with role <%= role%><%end%>
  <%end-%>
<% end %>